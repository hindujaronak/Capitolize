!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cortex=e()}}(function(){var e;return function t(e,r,n){function a(s,u){if(!r[s]){if(!e[s]){var o="function"==typeof require&&require;if(!u&&o)return o(s,!0);if(i)return i(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return a(r?r:t)},l,l.exports,t,e,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(t,r,n){(function(t){!function(t,a){"object"==typeof n&&"undefined"!=typeof r?r.exports=a():"function"==typeof e&&e.amd?e(a):t.DeepDiff=a()}(this,function(){"use strict";function e(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function n(e,t,r){n.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:r,enumerable:!0})}function a(e,t){a.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function i(e,t){i.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function s(e,t,r){s.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:r,enumerable:!0})}function u(e,t,r){var n=e.slice((r||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,n),e}function o(e){var t=typeof e;return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function p(e,t,r,l,f,h,c){f=f||[],c=c||[];var _=f.slice(0);if("undefined"!=typeof h){if(l){if("function"==typeof l&&l(_,h))return;if("object"==typeof l){if(l.prefilter&&l.prefilter(_,h))return;if(l.normalize){var d=l.normalize(_,h,e,t);d&&(e=d[0],t=d[1])}}}_.push(h)}"regexp"===o(e)&&"regexp"===o(t)&&(e=e.toString(),t=t.toString());var v=typeof e,y=typeof t,b="undefined"!==v||c&&c[c.length-1].lhs&&c[c.length-1].lhs.hasOwnProperty(h),w="undefined"!==y||c&&c[c.length-1].rhs&&c[c.length-1].rhs.hasOwnProperty(h);if(!b&&w)r(new a(_,t));else if(!w&&b)r(new i(_,e));else if(o(e)!==o(t))r(new n(_,e,t));else if("date"===o(e)&&e-t!==0)r(new n(_,e,t));else if("object"===v&&null!==e&&null!==t)if(c.filter(function(t){return t.lhs===e}).length)e!==t&&r(new n(_,e,t));else{if(c.push({lhs:e,rhs:t}),Array.isArray(e)){var g;e.length;for(g=0;g<e.length;g++)g>=t.length?r(new s(_,g,new i(void 0,e[g]))):p(e[g],t[g],r,l,_,g,c);for(;g<t.length;)r(new s(_,g,new a(void 0,t[g++])))}else{var k=Object.keys(e),m=Object.keys(t);k.forEach(function(n,a){var i=m.indexOf(n);i>=0?(p(e[n],t[n],r,l,_,n,c),m=u(m,i)):p(e[n],void 0,r,l,_,n,c)}),m.forEach(function(e){p(void 0,t[e],r,l,_,e,c)})}c.length=c.length-1}else e!==t&&("number"===v&&isNaN(e)&&isNaN(t)||r(new n(_,e,t)))}function l(e,t,r,n){return n=n||[],p(e,t,function(e){e&&n.push(e)},r),n.length?n:void 0}function f(e,t,r){if(r.path&&r.path.length){var n,a=e[t],i=r.path.length-1;for(n=0;i>n;n++)a=a[r.path[n]];switch(r.kind){case"A":f(a[r.path[n]],r.index,r.item);break;case"D":delete a[r.path[n]];break;case"E":case"N":a[r.path[n]]=r.rhs}}else switch(r.kind){case"A":f(e[t],r.index,r.item);break;case"D":e=u(e,t);break;case"E":case"N":e[t]=r.rhs}return e}function h(e,t,r){if(e&&t&&r&&r.kind){for(var n=e,a=-1,i=r.path?r.path.length-1:0;++a<i;)"undefined"==typeof n[r.path[a]]&&(n[r.path[a]]="number"==typeof r.path[a]?[]:{}),n=n[r.path[a]];switch(r.kind){case"A":f(r.path?n[r.path[a]]:n,r.index,r.item);break;case"D":delete n[r.path[a]];break;case"E":case"N":n[r.path[a]]=r.rhs}}}function c(e,t,r){if(r.path&&r.path.length){var n,a=e[t],i=r.path.length-1;for(n=0;i>n;n++)a=a[r.path[n]];switch(r.kind){case"A":c(a[r.path[n]],r.index,r.item);break;case"D":a[r.path[n]]=r.lhs;break;case"E":a[r.path[n]]=r.lhs;break;case"N":delete a[r.path[n]]}}else switch(r.kind){case"A":c(e[t],r.index,r.item);break;case"D":e[t]=r.lhs;break;case"E":e[t]=r.lhs;break;case"N":e=u(e,t)}return e}function _(e,t,r){if(e&&t&&r&&r.kind){var n,a,i=e;for(a=r.path.length-1,n=0;a>n;n++)"undefined"==typeof i[r.path[n]]&&(i[r.path[n]]={}),i=i[r.path[n]];switch(r.kind){case"A":c(i[r.path[n]],r.index,r.item);break;case"D":i[r.path[n]]=r.lhs;break;case"E":i[r.path[n]]=r.lhs;break;case"N":delete i[r.path[n]]}}}function d(e,t,r){if(e&&t){var n=function(n){(!r||r(e,t,n))&&h(e,t,n)};p(e,t,n)}}var v,y,b=[];return v="object"==typeof t&&t?t:"undefined"!=typeof window?window:{},y=v.DeepDiff,y&&b.push(function(){"undefined"!=typeof y&&v.DeepDiff===l&&(v.DeepDiff=y,y=void 0)}),e(n,r),e(a,r),e(i,r),e(s,r),Object.defineProperties(l,{diff:{value:l,enumerable:!0},observableDiff:{value:p,enumerable:!0},applyDiff:{value:d,enumerable:!0},applyChange:{value:h,enumerable:!0},revertChange:{value:_,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof y},enumerable:!0},noConflict:{value:function(){return b&&(b.forEach(function(e){e()}),b=null),l},enumerable:!0}}),l})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(e){var t=function(){function t(){n(this,t)}return a(t,null,[{key:"updateNode",value:function(e){var t=this._initNode(e);return e.newWrapper=t,e.childrenDiffs=this._applyChanges(e),this._updateChildNodes(e),t}},{key:"_initNode",value:function(t){var r,n=t.oldWrapper,a=t.root,i=t.eventId;r=a?a:new e({path:n.getPath().slice(),eventId:i}),r.__wrappers=this._shallowCopy(n.__wrappers);for(var s in r.__wrappers)r.__wrappers[s].__setEventId(i),r[s]=r.__wrappers[s];return r.__value=this._shallowCopy(n.__value),r}},{key:"_shallowCopy",value:function(t){var r;if(e.__isObject(t)){r={};for(var n in t)r[n]=t[n]}else if(e.__isArray(t)){r=[];for(var a=0,i=t.length;i>a;a++)r[a]=t[a]}return r}},{key:"_applyChanges",value:function(t){for(var r=t.oldWrapper,n=t.newWrapper,a=t.diffs,i=t.eventId,s={},u=0,o=a.length;o>u;u++){var p=a[u].path.slice();if(p.length>1){var l=p.shift();a[u].path=p,s[l]?s[l].push(a[u]):s[l]=[a[u]]}else if(1===p.length){var f=a[u],h=f.action,c=f.value,_=a[u].path[0];if("add"===h&&e.__isArray(n.__value))-1===_&&(_=n.__value.length),n.__value.splice(_,0,c),n.__wrappers.splice(_,0,new e({value:c,path:r.__path.concat(_),eventId:i}));else if("delete"===h){if(e.__isObject(n.__value))delete n.__value[_],delete n.__wrappers[_],delete n[_];else if(e.__isArray(n.__value)){var d=0;d=-1===_?n.__value.length-1:a[u].force?_:n.findIndex(function(e){return e.__path[e.__path.length-1]===_}),n.__value.splice(d,1),n.__wrappers.splice(d,1)}}else n.__value[_]=c,n.__wrappers[_]=new e({value:c,path:r.__path.concat(_),eventId:i}),n[_]=n.__wrappers[_]}else{if("delete"==a[u].action){for(var _ in n.__wrappers)delete n[_];return delete n.__value,delete n.__wrappers,[]}n.__value=a[u].value}}if(e.__isArray(n.__value)){for(var v=0,y=n.__wrappers.length;y>v;v++)this._updateWrapperPath({newWrapper:n.__wrappers[v],updatedIndex:v,updatedPathIndex:n.__path.length}),n[v]=n.__wrappers[v];for(;n[v];)delete n[v],v+=1}return s}},{key:"_updateWrapperPath",value:function(t){var r=t.newWrapper,n=t.updatedIndex,a=t.updatedPathIndex,i=r.__path;if(i[a]=n,e.__isArray(r.__value))for(var s=0,u=r.__wrappers.length;u>s;s++)this._updateWrapperPath({newWrapper:r.__wrappers[s],updatedIndex:n,updatedPathIndex:a});else if(e.__isObject(r.__value))for(var o in r.__wrappers)this._updateWrapperPath({newWrapper:r.__wrappers[o],updatedIndex:n,updatedPathIndex:a})}},{key:"_updateChildNodes",value:function(e){var t=e.oldWrapper,r=e.newWrapper,n=e.childrenDiffs,a=e.eventId;for(var i in n)r[i]=r.__wrappers[i]=this.updateNode({oldWrapper:t.__wrappers[i],diffs:n[i],eventId:a}),r.__value[i]=r.__wrappers[i].__value}}]),t}();return t}},{}],3:[function(e,t,r){"use strict";function n(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var a=r[n],i=Object.getOwnPropertyDescriptor(t,a);i&&i.configurable&&void 0===e[a]&&Object.defineProperty(e,a,i)}return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):n(e,t))}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(e,t,r){for(var n=!0;n;){var a=e,i=t,s=r;u=p=o=void 0,n=!1,null===a&&(a=Function.prototype);var u=Object.getOwnPropertyDescriptor(a,i);if(void 0!==u){if("value"in u)return u.value;var o=u.get;return void 0===o?void 0:o.call(s)}var p=Object.getPrototypeOf(a);if(null===p)return void 0;e=p,t=i,r=s,n=!0}};t.exports=function(){var t=e("./pubsub"),r=e("./immutable_wrapper")(t),n=e("./change_handler")(r),o=function(e){function r(e,t){a(this,r),u(Object.getPrototypeOf(r.prototype),"constructor",this).call(this),this.__value=e,this.__path=[],this.__callbacks=t?[t]:[],this.__updating=!1,this.__subscribe(),this.__wrap()}return i(r,e),s(r,[{key:"onUpdate",value:function(e){this.__callbacks.push(e)}},{key:"__update",value:function(e){if(e.length){this.__updating||(this.__diffs=[],this.__diffSignature={},this.__updating=!0,setTimeout(this.__updateAll.bind(this)));for(var t=0,r=e.length;r>t;t++){var n=JSON.stringify(e[t]);e[t].force?this.__diffs.push(e[t]):this.__diffSignature[n]||(this.__diffSignature[n]=!0,this.__diffs.push(e[t]))}}}},{key:"__subscribe",value:function(){this.__eventId=t.subscribeToCortex(function(e,t){this.__update(t)}.bind(this))}},{key:"__updateAll",value:function(){if(this.__diffs.length){var e=new r;e=n.updateNode({oldWrapper:this,root:e,diffs:this.__diffs,eventId:e.__eventId}),this.__runCallbacks(e),e.__callbacks=this.__callbacks.slice(),this.__callbacks=[],this.__updating=!1,delete this.__diffs,t.unsubscribeFromCortex(this.__eventId)}}},{key:"__runCallbacks",value:function(e){for(var t=0,r=this.__callbacks.length;r>t;t++)this.__callbacks[t]&&this.__callbacks[t](e)}}]),r}(r);return"undefined"!=typeof window&&null!==window&&(window.Cortex=o),o}()},{"./change_handler":2,"./immutable_wrapper":4,"./pubsub":5}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(t){var r=e("deep-diff").diff,i={N:"add",E:"update",A:"add",D:"delete"},s=function(){function e(t){n(this,e),t&&(this.__eventId=t.eventId,this.__value=t.value,this.__path=t.path||[]),this.__wrap(),this.val=this.getValue}return a(e,[{key:"getValue",value:function(){return this.__value}},{key:"getPath",value:function(){return this.__path}},{key:"getKey",value:function(){return this.__path[this.__path.length-1]}},{key:"set",value:function(e){var t=this.constructor.deepDiff(this.__value,e);if(t){for(var r,n,a=[],s=0,u=t.length;u>s;s++)n=this.__path.slice(),r=t[s],r.path&&(n=n.concat(r.path)),"undefined"!=typeof r.index&&n.push(r.index),a.push({action:i[r.item?r.item.kind:r.kind],path:n,value:r.item?r.item.rhs:r.rhs});this.__notifyUpdate(a)}}},{key:"forEach",value:function(e){if(this.constructor.__isObject(this.__wrappers))for(var t in this.__wrappers)e(t,this.__wrappers[t],this.__wrappers);else this.constructor.__isArray(this.__wrappers)&&this.__wrappers.forEach(e)}},{key:"destroy",value:function(){var e=[{action:"delete",path:this.__path.slice()}];this.__notifyUpdate(e)}},{key:"__forceUpdate",value:function(e,t,r){var n=[{action:e,path:this.__path.concat(t),value:r,force:!0}];this.__notifyUpdate(n)}},{key:"__notifyUpdate",value:function(e){e&&e.length&&t.publish("update"+this.__eventId,e)}},{key:"__setEventId",value:function(e){this.__eventId=e;for(var t in this.__wrappers)this.__wrappers[t].__setEventId(e)}},{key:"__wrap",value:function(){if(this.constructor.__isObject(this.__value)){this.__wrappers={};for(var e in this.__value)this.__wrapChild(e)}else if(this.constructor.__isArray(this.__value)){this.__wrappers=[];for(var t=0,r=this.__value.length;r>t;t++)this.__wrapChild(t)}}},{key:"__wrapChild",value:function(t){var r=this.__path.slice();r.push(t),this.__wrappers[t]=new e({value:this.__value[t],path:r,eventId:this.__eventId}),this[t]=this.__wrappers[t]}}],[{key:"deepDiff",value:function(e,t){return r(e,t)}},{key:"__isObject",value:function(e){return e&&e.constructor===Object}},{key:"__isArray",value:function(e){return e&&e.constructor===Array}}]),e}(),u=e("./wrappers/array_wrapper"),o=e("./wrappers/object_wrapper"),p=function(e,t){for(var r=0,n=t.length;n>r;r++)for(var a in t[r])e.prototype[a]=t[r][a]};return p(s,[u,o]),s}},{"./wrappers/array_wrapper":6,"./wrappers/object_wrapper":7,"deep-diff":1}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(){var e=function(){function e(){n(this,e),this.uid=-1,this.topics={}}return a(e,[{key:"subscribe",value:function(e,t){this.topics.hasOwnProperty(e)||(this.topics[e]=[]),this.topics[e].push({callback:t})}},{key:"publish",value:function(e,t){if(!this.topics.hasOwnProperty(e))return!1;for(var r=this.topics[e],n=0,a=r.length;a>n;n++)r[n].callback(e,t);return!0}},{key:"subscribeToCortex",value:function(e,t){return this.uid+=1,this.subscribe("update"+this.uid,e),this.subscribe("remove"+this.uid,t),this.uid}},{key:"unsubscribeFromCortex",value:function(e){delete this.topics["update"+e],delete this.topics["remove"+e]}}]),e}();return new e}()},{}],6:[function(e,t,r){"use strict";var n={count:function(){return this.__value.length},map:function(e,t){return this.__wrappers.map(e,t)},filter:function(e,t){return this.__wrappers.filter(e,t)},find:function(e){for(var t=0,r=this.__wrappers.length;r>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return this.__wrappers[t];return void 0},findIndex:function(e){for(var t=0,r=this.__wrappers.length;r>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return t;return-1},push:function(){for(var e=Array.prototype.slice.call(arguments),t=[],r=0,n=e.length;n>r;r++)t.push({action:"add",path:this.__path.concat(-1),value:e[r],force:!0});this.__notifyUpdate(t)},pop:function(){this.__forceUpdate("delete",-1)},unshift:function(){for(var e=Array.prototype.slice.call(arguments),t=[],r=0,n=e.length;n>r;r++)t.unshift({action:"add",path:this.__path.concat(0),value:e[r],force:!0});this.__notifyUpdate(t)},shift:function(){this.__forceUpdate("delete",0)},splice:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],r=Array.prototype.slice.call(arguments,2),n=[],a=0;t>a;a++)n.push({action:"delete",path:this.__path.concat(e),force:!0});for(var a=0,i=r.length;i>a;a++)n.push({action:"add",path:this.__path.concat(e+a),value:r[a],force:!0});this.__notifyUpdate(n)}};t.exports=n},{}],7:[function(e,t,r){"use strict";var n={keys:function(){return Object.keys(this.__value)},values:function a(){var a=[];for(var e in this.__value)a.push(this.__value[e]);return a},hasKey:function(e){return void 0!==this.__value[e]},remove:function(e){void 0!==e&&null!==e&&this.hasKey(e)&&this.__wrappers[e].destroy()},merge:function(e){var t=[];for(var r in e)t.push({action:"update",path:this.__path.concat(r),value:e[r]});this.__notifyUpdate(t)}};t.exports=n},{}]},{},[3])(3)});